<?xml version="1.0"?>

<!-- ================================================================= -->
<!-- Build file for the Gather web app                                 -->
<!--                                                                   -->
<!--   deploy: compiles and deploys to tomcat the entire app; in       -->
<!--           doing so, creates datalayer beans and the db schema,    -->
<!--           but doesn't deploy schema to database                   -->
<!--                                                                   -->
<!-- ================================================================= -->

<project name="Skyword PullApi Client Code" default="compile" basedir=".">

	<!-- ================================================== -->
	<!-- Load the properties, error out if unable to!       -->
	<!-- ================================================== -->
	<property environment="env" />
	<property file="build.properties" />

	<property name="pullapiclient.build.out" value="build_out"/>
	<property name="pullapiclient.build.out.dist" value="build_out/dist"/>
	<property name="pullapiclient.lib" value="lib"/>
	<property name="build.dir" value="build_out/classes" />
	<property name="generated.java.files" value="${basedir}" />
	<property name="src.dir" value="${basedir}/src" />

    <target name="all" depends="config, dist"/>
    	
	<!-- Project classpath -->
	<path id="pullapiclient.classpath">
		<fileset dir="${pullapiclient.lib}">
			<include name="*.jar" />
		</fileset>
		<pathelement path="${build.dir}" />
	</path>

	<!-- ================================================== -->
	<!-- OUR PUBLIC TARGETS                                 -->
	<!-- ================================================== -->
	<target name="config" depends="slave-config" />
	<target name="dist" depends="compile, slave-dist" />
	<target name="compile" depends="slave-compile" />

	<target name="just-compile">
		<javac srcdir="${src.dir}:${generated.java.files}" destdir="${build.dir}" debug="true" deprecation="${compile.deprecation}" optimize="${compile.optimize}">
			<classpath refid="pullapiclient.classpath" />
			<include name="**/*.java" />
		</javac>
	</target>

	<target name="just-dist" depends="slave-dist" />

	<!-- ================================================== -->
	<!-- OUR PRIVATE TARGETS                                -->
	<!-- ================================================== -->
	<target name="slave-deploy" />
	<target name="slave-clean">
		<delete dir="${build.dir}" />
		<delete dir="${pullapiclient.build.out}" />
	</target>

	<target name="slave-database-deploy" />
	<target name="slave-compile-dist" depends="slave-compile,slave-dist" />

	<target name="slave-config"> 
		<mkdir dir="${build.dir}" />
		<mkdir dir="${pullapiclient.build.out}" />
	</target>

	<target name="slave-compile" depends=" prepare">
		<javac srcdir="${src.dir}" destdir="${build.dir}" debug="true" deprecation="${compile.deprecation}" optimize="${compile.optimize}">
			<classpath refid="pullapiclient.classpath" />
			<include name="**/*.java" />
		</javac>
	</target>

	<target name="slave-dist">
		<mkdir dir="${pullapiclient.build.out.dist}/lib" />
		<mkdir dir="${pullapiclient.build.out.dist}/etc" />
		<jar destfile="${pullapiclient.build.out.dist}/lib/skyword-feed-client.jar" basedir="${build.dir}" />
	    <copy todir="${pullapiclient.build.out.dist}/lib">
	        <fileset dir="${pullapiclient.lib}" />
	    </copy>
		
	    <!-- Copy the property files -->
	    <copy todir="${pullapiclient.build.out.dist}/etc">
	        <fileset dir="./etc" />
	    </copy>
		
	    <copy todir="${pullapiclient.build.out.dist}">
	        <fileset dir="bin" includes="**/*.sh" />
	    </copy>
	        
	    <!-- Set the permission in unix for the shell files -->
	    <chmod perm="+x">
	        <fileset dir="${pullapiclient.build.out.dist}">
	            <include name="**/*.sh" />
	        </fileset>
	    </chmod>
		
	</target>

	<target name="prepare">
		<mkdir dir="${pullapiclient.build.out.dist}" />
		<mkdir dir="${generated.java.files}" />
		<mkdir dir="${build.dir}" />
	</target>

</project>
